<?php class dike_ajax_class{public function __construct(){add_action('wp_ajax_dike_get_remote_changelog',array($this,'dike_get_remote_changelog'));add_action('wp_ajax_dike_validate_domain_token',array($this,'dike_validate_domain_token'));}public static function ajax_json_die($status,$message='',$params=array()){$structure=array_merge(array('status'=>$status,'message'=>$message,),$params);wp_die(json_encode($structure));}public function dike_validate_domain_token(){global $dike_authors;if(!isset($_POST['dike_nonce'])||!wp_verify_nonce($_POST['dike_nonce'],'dike_nonce')){self::ajax_json_die('error','Cheating?');}if(!isset($_POST['author'])||!isset($dike_authors[$_POST['author']])){self::ajax_json_die('error','Author missing');}if(!isset($_POST['data'])||empty($_POST['data'])){self::ajax_json_die('error','Data missing');}$lic_class=new dike_licenses($_POST['author']);$response=$lic_class->validate_domain_token(stripslashes($_POST['data']));if($response===true){self::ajax_json_die('success','Token successfully validated!');}else{self::ajax_json_die('error',$response);}}}new dike_ajax_class();