(function(){var t,i,e;t=function(){function t(t,i){var e,o;if(this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",links:!0,mock:!1,useHttp:!1,afterLoad:null,api:"old",overlay:"",filter:"show"},"object"==typeof t)for(e in t)o=t[e],this.options[e]=o;this.context=null!=i?i:this,this.unique=this._genKey()}return t.prototype.hasNext=function(){return"string"==typeof this.context.nextUrl&&this.context.nextUrl.length>0},t.prototype.next=function(){return!!this.hasNext()&&this.run(this.context.nextUrl)},t.prototype.run=function(t){return this.parse(this.options.feed),!0},t.prototype.parse=function(t){var i,e,o,n,s,r,a,p,l,c,h,u,d,f,m,g,y,v,_,w;if("object"!=typeof t){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"Invalid JSON data"),!1;throw new Error("Invalid JSON response")}var k=this.options.filter;if(0===t.data.length){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"No images were returned from Instagram"),!1;throw new Error("No images were returned from Instagram")}if(null!=this.options.success&&"function"==typeof this.options.success&&this.options.success.call(this,t),this.context.nextUrl="",null!=t.pagination&&(this.context.nextUrl=t.pagination.next_url),"none"!==this.options.sortBy)switch(y="least"===(v="random"===this.options.sortBy?["","random"]:this.options.sortBy.split("-"))[0],v[1]){case"random":t.data.sort(function(){return.5-Math.random()});break;case"recent":t.data=this._sortBy(t.data,"created_time",y);break;case"liked":t.data=this._sortBy(t.data,"likes.count",y);break;case"commented":t.data=this._sortBy(t.data,"comments.count",y);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}if("undefined"!=typeof document&&null!==document&&!1===this.options.mock){for(c=t.data,g=parseInt(this.options.limit,10),null!=this.options.limit&&c.length>g&&(c=c.slice(0,g)),s=document.createDocumentFragment(),null!=this.options.filter&&"function"==typeof this.options.filter&&(c=this._filter(c,this.options.filter)),r="","",u="",w=document.createElement("div"),a=0,d=c.length;a<d;a++)if(p=c[a],h="square",l="new"===this.options.api?p.media_url:p.images.standard_resolution.url,"VIDEO"===p.media_type?(this.options.videos&&(u=p.media_url),l=p.thumbnail_url):"CAROUSEL_ALBUM"===p.media_type&&(l=p.media_url),l){window.location.protocol.indexOf("http")>=0&&!this.options.useHttp&&(l=l.replace(/https?:\/\//,"//"));var x=[!0];p.tags=this._extractTags(p.caption),""!==this.options.tagName&&this.options.tagName.forEach(function(t,i){t=t.toLowerCase(),-1===p.tags.indexOf(t)?x[i]=!1:x[i]=!0,"hide"===k&&(x[i]=!x[i])});var b=p.caption;p.caption&&""!==this.options.words&&(b=p.caption.split(/\s+/).slice(0,this.options.words).join(" "),b+="..."),-1!==x.indexOf(!0)&&(r+=this._makeTemplate({model:p,id:p.id,link:"old"===this.options.api?p.link:p.permalink,type:p.media_type,image:l,video:u,orientation:h,caption:b,likes:"old"===this.options.api&&p.likes.count,comments:"old"===this.options.api&&p.comments.count,location:this._getObjectProperty(p,"location.name")}))}for(w.innerHTML=r,o=[],e=0,i=w.childNodes.length;e<i;)o.push(w.childNodes[e]),e+=1;for(this.options.afterLoad(t),x=0,f=o.length;x<f;x++)m=o[x],s.appendChild(m);if("string"==typeof(_=this.options.target)&&(_=document.getElementById(_)),null==_)throw n='No element with id="'+this.options.target+'" on page.',new Error(n);_.appendChild(s)}return null!=this.options.after&&"function"==typeof this.options.after&&this.options.after.call(this),!0},t.prototype._buildUrl=function(){var t,i,e;switch(t="new"===this.options.api?"https://graph.instagram.com":"https://api.instagram.com/v1",this.options.get){case"popular":i="media/popular";break;case"user":i="new"===this.options.api?"me/media?fields=id,media_type,media_url,username,timestamp,permalink,caption,children,thumbnail_url&limit=200":"users/self/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}return e=t+"/"+i,null!=this.options.accessToken&&(e+="new"===this.options.api?"&":"?",e+="access_token="+this.options.accessToken),e+="&callback=instafeedCache"+this.unique+".parse"},t.prototype._extractTags=function(t){var i=/#([^\s]+)/gi,e=/[~`!@#$%^&*\(\)\-\+={}\[\]:;"'<>\?,\./|\\\s]+/i,o=[];if("string"==typeof t)for(;null!==(match=i.exec(t));)!1===e.test(match[1])&&o.push(match[1].toLowerCase());return o},t.prototype._genKey=function(){var t;return""+(t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)})()+t()+t()+t()},t.prototype._makeTemplate=function(t){var i,e,o,n,s;e=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/;var r=this.options.templateData;for(i='<div class="premium-insta-feed '+("VIDEO"===t.type?"premium-insta-video-wrap":"")+' premium-insta-box"><div class="premium-insta-feed-wrap"><div class="premium-insta-img-wrap"><img src="{{image}}"/>',"VIDEO"===t.type&&this.options.videos&&(i+="<video src={{video}} controls>"),i+="</div>",""!=this.options.overlay&&(i+='<div class="premium-insta-info-wrap">'),""!=r.description&&(i+='<div class="premium-insta-feed-interactions">'+r.likes+r.comments+r.description+"</div>"),""!=this.options.overlay&&(i+="</div>"),i+=r.link+"</div>"+r.share+"</div>";e.test(i);)n=i.match(e)[1],s=null!=(o=this._getObjectProperty(t,n))?o:"",i=i.replace(e,function(){return""+s});return i},t.prototype._getObjectProperty=function(t,i){var e,o;for(o=(i=i.replace(/\[(\w+)\]/g,".$1")).split(".");o.length;){if(e=o.shift(),!(null!=t&&e in t))return null;t=t[e]}return t},t.prototype._sortBy=function(t,i,e){var o;return o=function(t,o){var n,s;return n=this._getObjectProperty(t,i),s=this._getObjectProperty(o,i),e?n>s?1:-1:n<s?1:-1},t.sort(o.bind(this)),t},t.prototype._filter=function(t,i){var e,o,n,s;for(e=[],o=function(t){if(i(t))return e.push(t)},n=0,s=t.length;n<s;n++)o(t[n]);return e},t}(),i=this,e=function(){return t},"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():i.Instafeed=e()}).call(this);